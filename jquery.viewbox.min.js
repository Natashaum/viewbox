/**
 * ViewBox
 * @author Pavel Khoroshkov aka pgood
 */
!function(t){t.fn.viewbox=function(i){function n(n,e){x||(t("body").append(w),w.fadeIn(i.openDuration),x=!0);var a=o("body"),c=o("content");n&&c.width(n),e&&c.height(e),a.css({"margin-left":-a.width()/2,"margin-top":-a.height()/2})}function e(){x&&(w.fadeOut(i.closeDuration,function(){w.detach(),"function"==typeof p&&(p(),p=null)}),x=!1)}function o(t){return w.find(".viewbox-"+t)}function a(t,i){o(t).html(i)}function c(){var t=-1;return f&&g.each(function(i){return f.is(this)?(t=i,!1):void 0}),t}function r(){if(!(g.length<=1)){var t=c()+1;t>=g.length&&(t=0),g.eq(t).click()}}function l(){if(!(g.length<=1)){var t=c()-1;0>t&&(t=g.length-1),g.eq(t).click()}}function d(t){return t.match(/(png|jpg|jpeg|gif)$/i)}function s(i){return i.match(/^#.+$/i)&&t(i).length}function v(t){return t.get(0).complete}function u(t){t?b.appendTo(o("body")):b.detach()}function h(i){var n=t('<div class="viewbox-button-default viewbox-button-'+i+'"></div>');return n.appendTo(w).get(0).insertAdjacentHTML("afterbegin",'<svg><use xlink:href="#viewbox-'+i+'-icon"/></svg>'),n}"undefined"==typeof i&&(i={}),i=t.extend({template:'<div class="viewbox-container"><div class="viewbox-body"><div class="viewbox-header"></div><div class="viewbox-content"></div><div class="viewbox-footer"></div></div></div>',loader:'<div class="loader"><div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>',setTitle:!0,margin:20,resizeDuration:400,openDuration:200,closeDuration:200,closeButton:!0,navButtons:!0,closeOnSideClick:!0,nextOnContentClick:!0},i);var f,p,g=t(this),w=t(i.template),b=t(i.loader),x=!1,m=!1;return t("body").get(0).insertAdjacentHTML("afterbegin",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="viewbox-sprite" style="display:none"><symbol id="viewbox-close-icon" viewBox="0 0 50 50"><path d="M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z"/><path d="M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z"/></symbol><symbol id="viewbox-prev-icon" viewBox="0 0 50 50"><path d="M27.3 34.7L17.6 25l9.7-9.7 1.4 1.4-8.3 8.3 8.3 8.3z"/></symbol><symbol id="viewbox-next-icon" viewBox="0 0 50 50"><path d="M22.7 34.7l-1.4-1.4 8.3-8.3-8.3-8.3 1.4-1.4 9.7 9.7z"/></symbol></svg>'),g.click(function(){if(!m){var e=t(this),c=e.attr("href");if(a("header",i.setTitle&&e.attr("title")?e.attr("title"):""),d(c)){var r=t('<img class="viewbox-image" alt="">').attr("src",c);f=e,a("content",""),n(),v(r)||u(!0);var l=o("body"),h=0,g=o("content"),w=window.setInterval(function(){if(!v(r)&&1e3>h)return void h++;window.clearInterval(w),u(!1),t("body").append(r);var n=l.width()-g.width()+2*i.margin,e=l.height()-g.height()+2*i.margin,o=t(window).width()-n,a=t(window).height()-e,c=r.width(),d=r.height();r.detach(),c>o&&(d=d*o/c,c=o),d>a&&(c=c*a/d,d=a),m=!0,l.animate({"margin-left":-(c+n)/2+i.margin,"margin-top":-(d+e)/2+i.margin},i.resizeDuration),g.animate({width:c,height:d},i.resizeDuration,function(){g.append(r),m=!1})},v(r)?0:200)}else if(s(c)){var b=t('<div class="viewbox-content-placeholder"></div>'),x=t(c).replaceWith(b);p=function(){b.replaceWith(x)},a("content",""),o("content").append(x),n("auto","auto")}return!1}}),o("body").click(function(t){t.stopPropagation(),i.nextOnContentClick&&r()}),i.closeButton&&h("close").click(function(t){t.stopPropagation(),e()}),i.navButtons&&g.length>1&&(h("next").click(function(t){t.stopPropagation(),r()}),h("prev").click(function(t){t.stopPropagation(),l()})),i.closeOnSideClick&&w.click(e),this}}(jQuery);