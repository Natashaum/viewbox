/**
 * ViewBox
 * @author Pavel Khoroshkov aka pgood
 */
!function(t){t.fn.viewbox=function(n){function i(i,e){x||(t("body").append(w),w.fadeIn(n.openDuration),x=!0);var a=o("body"),c=o("content");i&&c.width(i),e&&c.height(e),a.css({"margin-left":-a.width()/2,"margin-top":-a.height()/2})}function e(){x&&(w.fadeOut(n.closeDuration,function(){w.detach(),"function"==typeof g&&(g(),g=null)}),x=!1)}function o(t){return w.find(".viewbox-"+t)}function a(t,n){o(t).html(n)}function c(){var t=-1;return h&&p.each(function(n){return h.is(this)?(t=n,!1):void 0}),t}function r(){if(!(p.length<=1)){var t=c()+1;t>=p.length&&(t=0),p.eq(t).click()}}function d(){if(!(p.length<=1)){var t=c()-1;0>t&&(t=p.length-1),p.eq(t).click()}}function l(t){return t.match(/(png|jpg|jpeg|gif)$/i)}function s(n){return n.match(/^#.+$/i)&&t(n).length}function v(t){return t.get(0).complete}function u(t){t?b.appendTo(o("body")):b.detach()}function f(n){var i=t('<div class="viewbox-button-default viewbox-button-'+n+'"></div>');return i.appendTo(w).get(0).insertAdjacentHTML("afterbegin",'<svg><use xlink:href="#viewbox-'+n+'-icon"/></svg>'),i}"undefined"==typeof n&&(n={}),n=t.extend({template:'<div class="viewbox-container"><div class="viewbox-body"><div class="viewbox-header"></div><div class="viewbox-content"></div><div class="viewbox-footer"></div></div></div>',loader:'<div class="loader"><div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>',setTitle:!0,margin:20,resizeDuration:400,openDuration:200,closeDuration:200,closeButton:!0,navButtons:!0,closeOnSideClick:!0,nextOnContentClick:!0},n);var h,g,p=t(this),w=t(n.template),b=t(n.loader),x=!1,m=!1;return w.bind("viewbox.close",function(){e()}),t("body").get(0).insertAdjacentHTML("afterbegin",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="viewbox-sprite" style="display:none"><symbol id="viewbox-close-icon" viewBox="0 0 50 50"><path d="M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z"/><path d="M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z"/></symbol><symbol id="viewbox-prev-icon" viewBox="0 0 50 50"><path d="M27.3 34.7L17.6 25l9.7-9.7 1.4 1.4-8.3 8.3 8.3 8.3z"/></symbol><symbol id="viewbox-next-icon" viewBox="0 0 50 50"><path d="M22.7 34.7l-1.4-1.4 8.3-8.3-8.3-8.3 1.4-1.4 9.7 9.7z"/></symbol></svg>'),p.click(function(){if(!m){var e=t(this),c=e.attr("href");if(a("header",n.setTitle&&e.attr("title")?e.attr("title"):""),l(c)){var r=t('<img class="viewbox-image" alt="">').attr("src",c);h=e,a("content",""),i(),v(r)||u(!0);var d=o("body"),f=0,p=o("content"),w=window.setInterval(function(){if(!v(r)&&1e3>f)return void f++;window.clearInterval(w),u(!1),t("body").append(r);var i=d.width()-p.width()+2*n.margin,e=d.height()-p.height()+2*n.margin,o=t(window).width()-i,a=t(window).height()-e,c=r.width(),l=r.height();r.detach(),c>o&&(l=l*o/c,c=o),l>a&&(c=c*a/l,l=a),m=!0,d.animate({"margin-left":-(c+i)/2+n.margin,"margin-top":-(l+e)/2+n.margin},n.resizeDuration),p.animate({width:c,height:l},n.resizeDuration,function(){p.append(r),m=!1})},v(r)?0:200)}else if(s(c)){var b=t('<div class="viewbox-content-placeholder"></div>'),x=t(c);x.before(b),g=function(){b.before(x),b.detach()},a("content",""),o("content").append(x),i("auto","auto")}return!1}}),o("body").click(function(t){t.stopPropagation(),n.nextOnContentClick&&r()}),n.closeButton&&f("close").click(function(t){t.stopPropagation(),e()}),n.navButtons&&p.length>1&&(f("next").click(function(t){t.stopPropagation(),r()}),f("prev").click(function(t){t.stopPropagation(),d()})),n.closeOnSideClick&&w.click(e),w}}(jQuery);