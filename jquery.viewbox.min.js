/**
 * ViewBox
 * @author Pavel Khoroshkov aka pgood
 */
!function(t){t.fn.viewbox=function(n){function i(i,e){var a,c,r=o("body"),d=o("content");i&&d.width(i),e&&d.height(e),y?(a=r.width(),c=r.height()):(y=!0,t("body").append(x),x.show(),a=r.width(),c=r.height(),x.hide(),x.fadeIn(n.openDuration)),r.css({"margin-left":-a/2,"margin-top":-c/2})}function e(t){return"undefined"!=typeof t?void("function"==typeof t&&z.push(t)):void(y&&x.fadeOut(n.closeDuration,function(){x.detach(),y=!1;for(var t=[];z.length;)t.push(z.shift());for(;t.length;)t.shift()()}))}function o(t){return x.find(".viewbox-"+t)}function a(t,n){o(t).html(n)}function c(){var t=-1;return w&&b.each(function(n){return w.is(this)?(t=n,!1):void 0}),t}function r(){if(!(b.length<=1)){var t=c()+1;t>=b.length&&(t=0),b.eq(t).click()}}function d(){if(!(b.length<=1)){var t=c()-1;0>t&&(t=b.length-1),b.eq(t).click()}}function l(t){return t.match(/(png|jpg|jpeg|gif)$/i)}function s(n){return n.match(/^#.+$/i)&&t(n).length}function v(t){return t.get(0).complete}function u(t){t?m.appendTo(o("body")):m.detach()}function h(n){var i=t('<div class="viewbox-button-default viewbox-button-'+n+'"></div>');return i.appendTo(x).get(0).insertAdjacentHTML("afterbegin",'<svg><use xlink:href="#viewbox-'+n+'-icon"/></svg>'),i}function f(e,c){var r=t('<img class="viewbox-image" alt="">').attr("src",e);v(r)||u(!0),a("content",""),a("header",c),i();var d=o("body"),l=0,s=o("content"),h=window.setInterval(function(){if(!v(r)&&1e3>l)return void l++;window.clearInterval(h),u(!1),t("body").append(r);var i=d.width()-s.width()+2*n.margin,e=d.height()-s.height()+2*n.margin,o=t(window).width()-i,a=t(window).height()-e,c=r.width(),f=r.height();r.detach(),c>o&&(f=f*o/c,c=o),f>a&&(c=c*a/f,f=a),k=!0,d.animate({"margin-left":-(c+i)/2+n.margin,"margin-top":-(f+e)/2+n.margin},n.resizeDuration),s.animate({width:c,height:f},n.resizeDuration,function(){s.append(r),k=!1})},v(r)?0:200)}function g(n,c){var r=t('<div class="viewbox-content-placeholder"></div>'),d=t(n);d.before(r),e(function(){r.before(d),r.detach()}),a("content",""),a("header",c),o("content").append(d),i("auto","auto")}function p(t){if(!k){var i=t.attr("href"),e=n.setTitle&&t.attr("title")?t.attr("title"):"";i?l(i)?(w=t,f(i,e)):s(i)&&(w=t,g(i,e)):(w=t,g(t,e))}}"undefined"==typeof n&&(n={}),n=t.extend({template:'<div class="viewbox-container"><div class="viewbox-body"><div class="viewbox-header"></div><div class="viewbox-content"></div><div class="viewbox-footer"></div></div></div>',loader:'<div class="loader"><div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>',setTitle:!0,margin:20,resizeDuration:400,openDuration:200,closeDuration:200,closeButton:!0,navButtons:!0,closeOnSideClick:!0,nextOnContentClick:!1},n);var w,b=t(this),x=t(n.template),m=t(n.loader),y=!1,k=!1,z=[];return t("#viewbox-sprite").length||t("body").get(0).insertAdjacentHTML("afterbegin",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="viewbox-sprite" style="display:none"><symbol id="viewbox-close-icon" viewBox="0 0 50 50"><path d="M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z"/><path d="M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z"/></symbol><symbol id="viewbox-prev-icon" viewBox="0 0 50 50"><path d="M27.3 34.7L17.6 25l9.7-9.7 1.4 1.4-8.3 8.3 8.3 8.3z"/></symbol><symbol id="viewbox-next-icon" viewBox="0 0 50 50"><path d="M22.7 34.7l-1.4-1.4 8.3-8.3-8.3-8.3 1.4-1.4 9.7 9.7z"/></symbol></svg>'),x.bind("viewbox.close",function(){e()}),x.bind("viewbox.open",function(t,n){var i=function(){b.length&&p(b.eq(n>=0&&n<b.length?n:0))};y?(e(i),e()):i()}),b.filter("a").click(function(){return p(t(this)),!1}),o("body").click(function(t){t.stopPropagation(),n.nextOnContentClick&&r()}),n.closeButton&&h("close").click(function(t){t.stopPropagation(),e()}),n.navButtons&&b.length>1&&(h("next").click(function(t){t.stopPropagation(),r()}),h("prev").click(function(t){t.stopPropagation(),d()})),n.closeOnSideClick&&x.click(function(){e()}),x}}(jQuery);